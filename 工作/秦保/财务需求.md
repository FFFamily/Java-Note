**关于 投保人 和 发票抬头**

默认的情况下，发票抬头用的是投保人的名称，所以在发票这边默认存的就是 投保人的名称

此时，有两种情况

一：选择 不开票

> 不开票，那么就会默认在系统中按照当前的保单信息添加一份“待申请”的发票申请记录

二：选择 开票

> 开票，那么就会按照正常的 “发票申请” 流程走



保单生成后，现在进入 “发票申请”流程

- 如果之前就选择的 “开票”，那么会在列表中看到自己 “已提交” 的申请记录，正常进入发票逻辑
- 如果之前选择的 “不开票”，那么就会在 “待申请” 中看到记录，这个时候展现的信息就是原来的 ”保单默认配置信息“ ，这个时候可以选择修改某些属性进行 “申请开票” 操作



对于保单生成后，又修改了投保人名称这样的操作，目前对于发票管理来说是无感的，因为申请界面是可变更的







关于 **移动端** | **发票列表查询**

默认一进入的情况，参数为

```json
{
  param:{
  	isApply: 0 // 待申请
  }
	page:1,
  pageSize:10
}
```

当有了 输入查询条件后 变为

```json
{
  input: "xxxx" // 因为输入查询时不能携带其他条件参数
	page:1,
  pageSize:10
}
```

当输入了 条件参数后变为

`param` 中`isApply` 为必填，其他的若为 `全部`，则不填

```json
{
  param:{
  	isApply: 0 // 待申请
    type: 0, // 保单类型 
    status: 0 // 发票状态
  }
	page:1,
  pageSize:10
}
```

返回的数据为 一个**数组**

- 判断是保单还是批单的方式为：去拿到 type 字段区别 0 | 1

  - 如果是保单，那么就去`policy` 字段中拿保单数据

  - 如果是批单，那么就去`endorsement` 字段中拿批单数据

- 校验发票状态就去拿 `status` 字段

> 待申请和已申请的判断后端已经做了，无需前端做过滤



关于获取 **发票详情** | **列表数据**

移动端 | 管理后台 通用

返回对象为：

```
{
	invoice:{},
	policy:{},
	endorsement:{}
}
```

因为之前没有考虑到批单和保单的数据的不同，现在做统一接口处理

需要前端做判断，去哪里拿数据



关于 **手动添加发票的方式**

1，需要去 core 项目中的 `/toolchain/script/invoice/orm.js`

2，输入对应的信息并执行

在 `orm.js` 的路径下执行

```
node orm.js
```



字段信息（5月23日版本）

```json
{
    "id": "429CEC7AB2FB433681D75227E72EE2E3", 
    "type": 1,
    "email": "56765@qq.com",
    "phone": "19835503978",
    "status": 0,
    "address": "湖南省永州市蓝山县所城镇",
    "history": [
        {
            "id": "866342B4C021485DA50AB0988C9BCB86",
            "data": {},
            "type": 5,
            "createdAt": 1684725593
        }
    ],
    "bankName": "浦发",
    "policyId": "738E4C16D38F4BE8A67E91865AE0DF31",
    "policyNo": "PGSH29M82T00",
    "accountId": "00002x001",
    "createdAt": 1684725593,
    "bankCardNo": "888888",
    "modifiedAt": 1684725593,
    "contactName": "张文昊",
    "insuranceId": "200000015",
    "invoiceName": "深圳市秦保科技有限公司",
    "invoiceType": 1,
    "orgAccountId": "00002x",
    "taxpayerCode": "91440300MA5GAK5U7E",
    "contactMobile": "19969132815",
    "endorsementId": "4E311F805EB04F3593AD1E1BA4FEE9DF",
    "endorsementNo": "2023052202",
    "contactAddress": "甘肃省嘉峪关市嘉峪关市新城镇",
  	"scanUrl":[],
  	"extraData":{},
  	"subbranch":"",
  	"taxpayerType":0,
  	"electronicUrl":"",
  	"trackNo":""
}
```

字段描述

| 字段名         | 字段描述                                                     |
| -------------- | ------------------------------------------------------------ |
| id             |                                                              |
| type           | 保单类型：0 保单 \| 1 批单                                   |
| email          | 邮箱                                                         |
| phone          | 税务登记联系电话                                             |
| status         | 发票申请状态 -1 待申请、0 已申请、1 已开票、3 保司开票中、4 开票失败、5 已报废 |
| address        | 税务登记地址                                                 |
| history        | 历史记录                                                     |
| bankName       | 开户银行名称                                                 |
| policyId       | 保单Id                                                       |
| policyNo       | 保单号                                                       |
| accountId      | 业务员Id                                                     |
| createdAt      | 创建时间                                                     |
| bankCardNo     | 银行账号(卡号)                                               |
| modifiedAt     | 更新时间（申请时间）                                         |
| contactName    | 收件人                                                       |
| insuranceId    | 险种Id                                                       |
| invoiceName    | 发票抬头(投保人)                                             |
| invoiceType    | 发票类型：0 电子普票 \| 1 纸质专票                           |
| orgAccountId   | 组织id                                                       |
| taxpayerCode   | 纳税人识别号                                                 |
| contactMobile  | 收件人联系方式                                               |
| endorsementId  | 批单Id                                                       |
| endorsementNo  | 批单号                                                       |
| contactAddress | 收件地址                                                     |
| scanUrl        | 发票扫描件                                                   |
| extraData      | 额外字段                                                     |
| subbranch      | 所在支行                                                     |
| taxpayerType   | 纳税人类型                                                   |
| electronicUrl  | 电子发票url                                                  |
| trackNo        | 快递单号                                                     |
|                |                                                              |
|                |                                                              |
|                |                                                              |
|                |                                                              |
|                |                                                              |
|                |                                                              |
|                |                                                              |
|                |                                                              |
|                |                                                              |

纳税人类型（taxpayerType）枚举

```
TaxpayerType: {
        境内个人: 0, // 境内个人
        小规模纳税人: 1, // 小规模纳税人
        增值税一般纳税人: 2, // 增值税一般纳税人
        非增值税纳税人: 3, // 非增值税纳税人
    },
```

历史记录

| id        | 表编号                                 |
| --------- | -------------------------------------- |
| data      | 包含 invoice 的所有内容（history除外） |
| type      | 操作类型                               |
| remark    | 备注（失败原因）                       |
| createdAt | 创建时间                               |

以下是操作类型的枚举

```
BACK(0L, "打回"),
INVOICED(1L, "确认开票"),
SCRAPPED(2L, "报废"),
CHANGE(3L, "工作人员修改申请信息"),
RESUBMIT(4L, "重新提交"),
START(5L,"发起申请"),
UPDATE(6L, "更新信息"),
WITHDRAW(7L,"撤回"),
SEND(8L,"保司开票中");
```

