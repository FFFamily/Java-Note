# 面试题

`Mysql` 和 `PG` 的区别

https://aws.amazon.com/cn/compare/the-difference-between-mysql-vs-postgresql/

| 类别        | MySQL                                                     | PostgreSQL                                                   |
| ----------- | --------------------------------------------------------- | ------------------------------------------------------------ |
| 数据库技术  | MySQL 是一个纯粹的关系数据库管理系统。                    | PostgreSQL 是一个对象关系数据库管理系统。                    |
| 功能        | MySQL 对视图、触发器和过程等数据库功能提供有限支持。      | PostgreSQL 支持大多数高级数据库功能，例如实体化视图、*INSTEAD OF* 触发器和多种语言的存储过程。 |
| 数据类型    | MySQL 支持数字、字符、日期和时间、空间和 JSON 数据类型。  | PostgreSQL 支持所有 MySQL 数据类型，以及几何、枚举、网络地址、数组、范围、XML、hstore 和组合。 |
| ACID 合规性 | MySQL 仅针对 InnoDB 和 NDB 集群存储引擎具有 ACID 兼容性。 | PostgreSQL 始终符合 ACID。                                   |
| 索引        | MySQL 支持 B 树和 R 树索引。                              | PostgreSQL 支持多种索引类型，例如表达式索引、部分索引和带有树的哈希索引。 |
| 性能        | MySQL 提高了高频读取操作的性能。                          | PostgreSQL 提高了高频写入操作的性能。                        |
| 初学者支持  | MySQL 更容易入门。它为非技术用户提供了更广泛的工具集。    | PostgreSQL 的入门比较复杂。它为非技术用户提供的工具集有限。  |



-----



`Mysql` 中的锁机制

> 引用：https://cloud.tencent.com/developer/article/1546932

1. 首先是什么是锁

在计算机科学中，锁是在执行多线程时用于强行限制资源访问的同步机制

2. 数据库中锁的分类

- 行级锁
  - 行级锁是 `Mysql` 中锁定粒度最细的一种锁，表示只针对当前操作的行进行加锁。
  - 行级锁能大大减少数据库操作的冲突。
  - 其加锁粒度最小，并发度高，但加锁的开销也最大。行级锁分为 共享锁 和 排他锁。

- 表级锁
  - 是MySQL中锁定粒度最大的一种锁，表示对当前操作的整张表加锁，它实现简单，资源消耗较少，被大部分MySQL引擎支持
  - 最常使用的MYISAM与INNODB都支持表级锁定。
  - 表级锁定分为表共享读锁（共享锁）与表独占写锁（排他锁）。

- 页级锁
  - 是MySQL中锁定粒度介于行级锁和表级锁中间的一种锁。
  - 表级锁速度快，但冲突多，行级冲突少，但速度慢。所以取了折衷的页级，一次锁定相邻的一组记录。
  - BDB支持页级锁

3. 对应存储引擎中的锁

- `MyISAM`和`MEMORY`采用 表级锁
- `BDB` 采用页面锁 或 表级锁，默认为页面锁
- `InnoDB` 支持行级锁和表级锁,默认为行级锁

> nnoDB行锁是通过给索引上的索引项加锁来实现的
>
> InnoDB这种行锁实现特点意味着：==**只有通过索引条件检索数据，InnoDB才使用行级锁，否则，InnoDB将使用表锁！**==

4. 共享锁（读锁）和排他锁（写锁）

共享锁

- 共享锁又称读锁，是读取操作创建的锁。其他用户可以并发读取数据，但任何事务都不能对数据进行修改（获取数据上的排他锁），直到已释放所有共享锁。
- 用法 `SELECT ... LOCK IN SHARE MODE`

排它锁

- 排他锁又称写锁，如果事务T对数据A加上排他锁后，则其他事务不能再对A加任任何类型的封锁。获准排他锁的事务既能读数据，又能修改数据。
- 用法 `SELECT ... FOR UPDATE`

5. 乐观锁和悲观锁

乐观锁

- 认为数据一般情况下不会造成冲突，所以在数据进行提交更新的时候，才会正式对数据的冲突与否进行检测，如果发现冲突了，则让返回用户错误的信息，让用户决定如何去做。
- 乐观锁并不会使用数据库提供的锁机制。
- 一般的实现乐观锁的方式就是记录数据版本：版本号和时间戳
- 可能会有：例如两个事务都读取了数据库的某一行，经过修改以后写回数据库，这时就遇到了问题

悲观锁

- 悲观锁的实现，往往依靠数据库提供的锁机制 （也只有数据库层提供的锁机制才能真正保证数据访问的排他性，否则，即使在本系统中实现了加锁机制，也无法保证外部系统不会修改数据）

悲观锁的流程

- 在对任意记录进行修改前，先尝试为该记录加上排他锁。
- 如果加锁失败，说明该记录正在被修改，那么当前查询可能要等待或者抛出异常。具体响应方式由开发者根据实际需要决定。
- 如果成功加锁，那么就可以对记录做修改，事务完成后就会解锁了。
- 其间如果有其他对该记录做修改或加排他锁的操作，都会等待我们解锁或直接抛出异常。



**针对线上的数据库，你会做哪些监控，业务性能** **+** **数据安全 角度分析**

大厂一般都有数据库监控后台，里面指标很多，但是开发人员也必须知道 

业务性能

1、应用上线前会审查业务新增的sql，和分析sql执行计划 

比如是否存在 select * ，索引建立是否合理 

2、开启慢查询日志，定期分析慢查询日志 

3、监控CPU/内存利用率，读写、网关IO、流量带宽 随着时间的变化统计图 

4、吞吐量QPS/TPS，一天内读写随着时间的变化统计图 

数据安全

1、短期增量备份，比如一周一次。 定期全量备份，比如一月一次 

2、检查是否有非授权用户，是否存在弱口令，网络防火墙检查 

3、导出数据是否进行脱敏，防止数据泄露或者黑产利用 

4、数据库 全量操作日志审计，防止数据泄露 

5、数据库账号密码 业务独立，权限独立控制，防止多库共用同个账号密码 

6、高可用 主从架构，多机房部署



## Limit 10000如何优化

```sql
select * from Member limit 10000,100
```

1，子查询优化

先找出第一条数据，然后大于等于这条数据的id 就是要获取的数据

```sql
# 缺点：数据必须是连续的，可以说不能有 where 条件，where 条件会筛选数据
select * from Member where MemberID >= ( select MemberID from Member limit 100000,1) limit 100
```

2，使用 id 限定优化

```mysql
select * from orders_history where type=2 and id between 1000000 and 1000100 limit 100;
```

3，反查询优化

order by 优化比较麻烦，要增加索引，索引影响数据的修改效率，并且要知道总记录数，偏移大于数据的一半

```mysql
Select * from 'abc' where 'id' = 123 order by date desc limt 428775,40
```





## char varchar text 区 别

char 最大长度是 255 字符，注意是字符数和字符集没关系。可以有默认值，尾部有空格会被截断。

varchar 的总结：
varchar 的最大长度 65535 是指能存储的字节数，其实最多只能存储 65532 个字节，还有 3 个字节用于存储长度。注意是字节数这个和字符集有关系。

一个汉字字符用 utf8 占用 3字节，用 gbk 占用 2 字节。可以有默认值，尾部有空格不会截断。

text 的总结：
text 和 varchar 基本相同。text 会忽略指定的大小这和 varchar 有所不同，text 不能有默认值。尾部有空格不会被截断。t

ext 使用额外的 2 个字节来存储数据的大小，varchar 根据存储数据的大小选择用几个字节来存储。

text 的 65535 字节全部用来存储数据，varchar 则会占用 1－3 个字节去存储数据大小。



## drop delete truncate 区 别

delete 和 truncate 只删除表的数据不删除表的结构

> delete 语句是 dml,这个操作会放到 rollback segement 中,事务提交之后才生效;
>
> 如果有相应的 trigger,执行的时候将被触发. truncate,drop 是ddl, 操作立即生效,原数据不放到
>
> rollback segme nt 中,不能回滚. 操作不触发 trigger.



drop (DDL) 直接删掉表

truncate(DDL) 删除表中数据，再插入时自增长id 又从 1 开始

> 想保留表而删除所有的数据时，使用truncate

delete(DML) 删除表中数据，可以加where 字句。

> 想删除表的部分数据行，就使用delete





## mysql 用的什么版本 5.7 跟 5.6 有啥区别 

提升 MySQL 安全性



## 如何保证缓存一致性





如何在长文本中快捷的筛选出你的名字？ 

全文索引多列索引及最左前缀原则和其他使用场景
数据库的完整性约束，事务隔离级别，写一个 SQL 语句，索引的最左前缀原则数据库悲观锁怎么实
现的
建表的原则
索引的内涵和用法写怎么创建表
给了两条 SQL 语句，让根据这两条语句建索引（个人想法：主要考虑复合索引只能匹配前缀列的特
点）
select 语句实现顺序
那么我们来聊一下数据库。A 和 B 两个表做等值连接(Inner join) 怎么优化 哈希数据库连接
池的理解和优化
.数据库事物，什么是事物，什么情况下会用到事物，举例说明
Sql 语句。增删改查基本语句，建表建索引。需要注意细节，比如 count 是否计算 null 值的行等。
Sql 语句 分组排序
SQL 语句的 5 个连接概念
数据库优化和架构（主要是主从分离和分库分表相关） 分库分表 跨库 join 实现 探讨 主从
分离和分库分表相关
数据库中间件
跨库 join
读写分离在中间件的实现
限流 and 熔断
行锁适用场景