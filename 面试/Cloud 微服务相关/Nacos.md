## 持久化

`Nacos` 持久化原理

Nacos是一个用于配置管理、服务发现和动态 DNS 服务的开源平台。Nacos支持存储配置数据和服务实例数据的持久化，下面是Nacos持久化的原理：

Nacos持久化采用的是数据库存储的方式，它支持MySQL、Oracle、MariaDB和SQLite等关系型数据库。Nacos在启动时，会将配置和服务实例数据加载到内存中，并在内存中对数据进行操作。Nacos提供了两种数据持久化方式：JDBC和Nacos自带的Raft协议。

JDBC持久化是将Nacos的配置和服务实例数据存储在关系型数据库中，数据的操作通过JDBC API完成。在Nacos的配置文件中，可以配置数据源和对应的数据库连接信息，Nacos会自动创建表结构，将数据存储到对应的表中。当Nacos在启动时，会从数据库中读取数据，加载到内存中进行操作。

Raft协议是一种分布式一致性协议，Nacos通过Raft协议实现了服务实例数据的持久化。Raft协议将集群中的每个节点划分为三种角色：Leader、Follower和Candidate。Leader节点负责处理客户端请求和复制数据，Follower节点负责接收并复制Leader节点的数据，Candidate节点则是为了选举新的Leader而存在。Nacos将服务实例数据存储在Leader节点上，当Leader节点发生变化时，新的Leader节点会从旧的Leader节点中复制数据。当Leader节点宕机时，集群中的节点会通过选举机制选举出新的Leader节点，新的Leader节点会从数据库中恢复数据，并继续提供服务。

总的来说，Nacos的持久化原理是将配置和服务实例数据存储在关系型数据库中，并通过JDBC API或Raft协议进行数据操作和持久化。这样，在Nacos发生重启或宕机时，数据不会丢失，可以快速恢复。



**业务系统有没做消息的重复消费处理，是怎么做的**

幂等性：一个请求，不管重复来多少次，结果是不会改变的

RabbitMQ、RocketMQ、Kafka等任何队列不保证消息不重复，如果业务需要消息不重复消费，

则需要消费端处理业务消息要保持幂等性

方式一：Redis的setNX() , 做消息id去重 java版本目前不支持设置过期时间

方式二：redis的 Incr 原子操作：key自增，大于0 返回值大于0则说明消费过，(key可以是消

息的md5取值, 或者如果消息id设计合理直接用id做key)

方式三：数据库去重表





**压缩是时间换空间，还是空间换时间？**

web层主要涉及浏览器和服务器的网络交互，而网络交互显然是耗费时间的

要尽量减少交互次数、降低每次请求或响应数据量。

因此开启压缩进行性能优化

在服务端是时间换空间的策略，服务端需要牺牲时间进行压缩以减小响应数据大小

压缩后的内容可以获得更快的网络传输速度，时间是得到了优化

所以是双向的





